# Prompt Engineering

## ภาพรวม

Prompt Engineering ในระบบ AI Property Consultant ถูกออกแบบมาเพื่อให้การสนทนาระหว่าง AI และผู้ใช้เป็นไปอย่างมีประสิทธิภาพ โดยมีการกำหนดรูปแบบการสนทนาและภาษาให้เหมาะสมกับผู้ใช้

## รูปแบบการสนทนา

ระบบรองรับ 4 รูปแบบการสนทนา:

1. **แบบทางการ (Formal)**
   - ใช้ภาษาทางการ
   - เน้นความสุภาพ
   - ตัวอย่าง: "สวัสดีครับ/ค่ะ มีอสังหาริมทรัพย์ที่ตรงกับความต้องการของคุณดังนี้..."

2. **แบบทั่วไป (Casual)**
   - ใช้ภาษาทั่วไป
   - เป็นธรรมชาติ
   - ตัวอย่าง: "สวัสดี มีตัวเลือกที่น่าสนใจดังนี้..."

3. **แบบเป็นกันเอง (Friendly)**
   - ใช้ภาษาสบายๆ
   - เหมือนคุยกับเพื่อน
   - ตัวอย่าง: "สวัสดีจ้า มีตัวเลือกดีๆ มาแนะนำจ้า..."

4. **แบบมืออาชีพ (Professional)**
   - ใช้ภาษามืออาชีพ
   - ให้ข้อมูลเชิงลึก
   - ตัวอย่าง: "สวัสดีครับ/ค่ะ ผม/ดิฉันได้คัดสรรอสังหาริมทรัพย์ที่เหมาะสมดังนี้..."

## การจัดการภาษา

ระบบรองรับ 2 ภาษา:
- ภาษาไทย (thai)
- ภาษาอังกฤษ (english)

## การสร้างการตอบสนอง

### 1. การสร้างการตอบสนองพื้นฐาน
```python
def generate_response(self, query: str, properties: List[Dict[str, Any]], style: str = "formal", context: List[Dict[str, Any]] = None) -> str:
    try:
        # ตรวจสอบว่ามีข้อมูลอสังหาริมทรัพย์หรือไม่
        if not properties:
            responses = {
                "formal": f"ขออภัยครับ ทางเราไม่พบข้อมูลอสังหาริมทรัพย์ที่ตรงกับคำถาม '{query}' กรุณาลองใช้คำค้นหาอื่น หรือติดต่อเจ้าหน้าที่เพื่อขอข้อมูลเพิ่มเติม",
                "casual": f"เราไม่เจอข้อมูลที่คุณถามเกี่ยวกับ '{query}' ลองถามใหม่ด้วยคำอื่นได้นะ หรือจะติดต่อเจ้าหน้าที่ก็ได้ครับ",
                "friendly": f"โอ้! ดูเหมือนว่าเรายังไม่มีข้อมูลเกี่ยวกับ '{query}' เลย ลองถามใหม่แบบอื่นไหมคะ หรือจะคุยกับพนักงานของเราโดยตรงก็ได้นะคะ",
                "professional": f"ผมขอแจ้งว่าไม่พบข้อมูลอสังหาริมทรัพย์ที่ตรงตามเงื่อนไข '{query}' ในระบบ ผมแนะนำให้ปรับเปลี่ยนคำค้นหา หรือหากต้องการความช่วยเหลือเพิ่มเติม สามารถติดต่อทีมงานมืออาชีพของเราได้ครับ"
            }
            return responses.get(style, responses["formal"])
        
        # สร้างคำอธิบายอสังหาริมทรัพย์
        property_descriptions = []
        for i, prop in enumerate(properties):
            desc = f"{i+1}. "
            
            if "ประเภท" in prop:
                desc += f"{prop['ประเภท']} "
            
            if "โครงการ" in prop:
                desc += f"{prop['โครงการ']} "
            
            if "ราคา" in prop:
                desc += f"ราคา {prop['ราคา']} บาท "
            
            if "รูปแบบ" in prop:
                desc += f"({prop['รูปแบบ']}) "
            
            nearby = []
            if "สถานศึกษา" in prop and prop["สถานศึกษา"] != "ไม่มี":
                nearby.append(f"ใกล้{prop['สถานศึกษา']}")
            
            if "สถานีรถไฟฟ้า" in prop and prop["สถานีรถไฟฟ้า"] != "ไม่มี":
                nearby.append(f"ใกล้{prop['สถานีรถไฟฟ้า']}")
                
            if "ห้างสรรพสินค้า" in prop and prop["ห้างสรรพสินค้า"] != "ไม่มี":
                nearby.append(f"ใกล้{prop['ห้างสรรพสินค้า']}")
                
            if nearby:
                desc += f" {', '.join(nearby)}"
                
            property_descriptions.append(desc)
        
        property_text = "\n".join(property_descriptions)
        
        # สร้างการตอบสนองตามรูปแบบ
        intros = {
            "formal": f"สำหรับคำถามเกี่ยวกับ '{query}' ทางเรามีข้อมูลอสังหาริมทรัพย์ที่น่าสนใจดังนี้:\n\n",
            "casual": f"เกี่ยวกับ '{query}' ที่คุณถามมา เรามีตัวเลือกเหล่านี้นะ:\n\n",
            "friendly": f"สำหรับ '{query}' ที่คุณสนใจ มีตัวเลือกน่าสนใจเหล่านี้เลยค่ะ:\n\n",
            "professional": f"ตามที่คุณสอบถามเกี่ยวกับ '{query}' ผมได้คัดสรรอสังหาริมทรัพย์ที่ตรงกับความต้องการของคุณดังนี้:\n\n"
        }
        
        outros = {
            "formal": "\n\nท่านสนใจทรัพย์สินรายการใดเป็นพิเศษหรือไม่ ทางเรายินดีให้ข้อมูลเพิ่มเติมครับ",
            "casual": "\n\nสนใจตัวไหนเป็นพิเศษมั้ย จะได้บอกรายละเอียดเพิ่มเติมให้",
            "friendly": "\n\nชอบตัวไหนเป็นพิเศษบ้างคะ บอกได้เลยนะ เดี๋ยวเราช่วยดูข้อมูลเพิ่มให้ค่ะ",
            "professional": "\n\nหากคุณสนใจอสังหาริมทรัพย์รายการใดเป็นพิเศษ ผมสามารถให้ข้อมูลเชิงลึกและจัดการดูพื้นที่จริงให้ได้ครับ"
        }
        
        intro = intros.get(style, intros["formal"])
        outro = outros.get(style, outros["formal"])
        
        return intro + property_text + outro
        
    except Exception as e:
        return "ขออภัย เกิดข้อผิดพลาดในการประมวลผลคำตอบ กรุณาลองใหม่อีกครั้ง"
```

### 2. การแปลภาษา
```python
def translate(self, text: str, target_language: str = "en") -> str:
    """
    แปลข้อความระหว่างภาษาไทยและภาษาอังกฤษ
    
    ในระบบจริงจะใช้โมเดลการแปล
    """
    logger.info(f"Translation requested to {target_language}")
    # การใช้งานจริง
    return f"[Translated to {target_language}]: {text}"
```

## การใช้งาน

### 1. การสร้างการตอบสนอง
```python
# สร้าง LanguageModelManager
model_manager = LanguageModelManager()

# สร้างการตอบสนอง
response = model_manager.generate_response(
    query="ต้องการคอนโดใกล้รถไฟฟ้า",
    properties=[...],
    style="formal",
    context=None
)
```

### 2. การแปลภาษา
```python
# แปลข้อความ
translated_text = model_manager.translate(
    text="สวัสดีครับ มีอสังหาริมทรัพย์ที่น่าสนใจดังนี้",
    target_language="en"
)
```

## การบำรุงรักษา

### 1. การอัปเดต
- เพิ่มรูปแบบการสนทนาใหม่
- ปรับปรุงการตอบสนอง
- เพิ่มภาษาใหม่

### 2. การตรวจสอบ
- ตรวจสอบความถูกต้องของการตอบสนอง
- ตรวจสอบความเหมาะสมของรูปแบบการสนทนา
- ตรวจสอบความถูกต้องของการแปล

### 3. การแก้ไขปัญหา
- แก้ไขข้อผิดพลาดในการตอบสนอง
- ปรับปรุงรูปแบบการสนทนา
- แก้ไขข้อผิดพลาดในการแปล 